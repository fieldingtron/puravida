---
const props = Astro.props || {};
console.log('Props passed to Testimonials component:', props);
const testimonials = props.testimonials || [
  {
    image: '/public/img/default.jpg',
    name: 'Default Name',
    location: 'Default Location',
    quote: 'Default quote.'
  }
];
---

<section
  id="testimonials"
  class="py-12 bg-no-repeat bg-[position:right_center] bg-fixed md:bg-sunflower"
>
  <div class="container mx-auto px-4 text-center">
    <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-gray-100 capitalize">
      Testimonials
    </h2>

    <div class="relative max-w-3xl mx-auto" id="testimonial-display">
      <img
        id="testimonial-image"
        src={testimonials[0].image}
        alt={testimonials[0].name}
        class="w-64 h-64 mx-auto rounded-full border-4 border-blue-500"
      />
      <blockquote
        id="testimonial-quote"
        class="text-lg italic text-gray-700 dark:text-gray-300 mt-4"
      >
        &ldquo;{testimonials[0].quote}&rdquo;
      </blockquote>
      <div class="mt-4">
        <p
          id="testimonial-name"
          class="text-lg font-semibold text-gray-900 dark:text-gray-100"
        >
          {testimonials[0].name}
        </p>
        <p
          id="testimonial-location"
          class="text-sm text-gray-500 dark:text-gray-400"
        >
          {testimonials[0].location}
        </p>
      </div>
    </div>

    <div class="flex justify-center space-x-2 mt-6">
      {testimonials.map((_: any, index: number) => (
        <button
          type="button"
          class={`h-3 w-3 rounded-full transition-colors ${index === 0 ? "bg-blue-500" : "bg-gray-400 dark:bg-gray-600"}`}
          data-index={index}
        ></button>
      ))}
    </div>
  </div>

  <script type="module">
    const testimonials = JSON.parse(`{JSON.stringify(testimonials)}`);
    let currentIndex = 0;
    const image = document.getElementById("testimonial-image");
    const quote = document.getElementById("testimonial-quote");
    const name = document.getElementById("testimonial-name");
    const location = document.getElementById("testimonial-location");
    const buttons = document.querySelectorAll("button[data-index]");

    function updateDisplay(index) {
      const t = testimonials[index];
      image.src = t.image;
      image.alt = t.name;
      quote.innerHTML = `&ldquo;${t.quote}&rdquo;`;
      name.textContent = t.name;
      location.textContent = t.location;

      buttons.forEach((btn, i) => {
        btn.classList.toggle("bg-blue-500", i === index);
        btn.classList.toggle("bg-gray-400", i !== index);
        btn.classList.toggle("dark:bg-gray-600", i !== index);
      });

      currentIndex = index;
    }

    buttons.forEach((btn) => {
      btn.addEventListener("click", () => {
        updateDisplay(parseInt(btn.dataset.index));
      });
    });

    setInterval(() => {
      const nextIndex = (currentIndex + 1) % testimonials.length;
      updateDisplay(nextIndex);
    }, 4000);
  </script>
</section>
